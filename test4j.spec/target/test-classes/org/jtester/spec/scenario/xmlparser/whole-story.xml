<story>
	<description>P4P消耗交易的测试类总体描述
		用于接收BSS系统发送过来的日结消耗信息，并封装交易和执行交易
	</description>
	<scenarios>
		<scenario name="[Case01-成功]中文站会员P4P现金账户项余额100元，进行日结P4P现金消耗50元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item031',
				'ITEM_TYPE':'P4P',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为现金扣款，扣款金额为50元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":50,
				"execTally":0,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的账户余额
				【账户项=[{'ITEM_TYPE':'P4P','ITEM_BALA':'50'}]】
			</method>
			<method type="then" name="check trade result">
				检查交易表的交易类型，审核状态，执行状态
				【账户交易=[{'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'EXEC_STATUS':'success'}
				]】

				检查交易项表的交易类型，交易金额，交易状态（AP/O交易）
				【账户交易项=[{'TRADE_STYLE':'self',
				'TRADE_TYPE':'AP/O',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'50',
				'FROM_ENTITY':'P4pAccount',
				'FROM_NO':'10000M00001',
				'FROM_NO_DETAIL':'Item031',
				'TO_ENTITY':'StraightOrderItem',
				'TO_NO_DETAIL':'P4P',
				'EXEC_STATUS':'success',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TYPE_CODE':'APXOXXXX'}
				]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'ALL_INCOMING',
				'EXEC_AMOUNT':'50',
				'RECEIPT_AMOUNT':'50',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'0',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check account record">
				检查账户变更记录表的交易记录
				【现金交易记录=[{'VACCOUNT_ID':'10000',
				'CUSTOMER_NAME':'罗锐集成测试公司',
				'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'TRADE_COMMENTS':'即时付费订单自动扣款',
				'TRADE_ITEM_TYPE':'AP/O',
				'EXEC_STATUS':'success',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'-50',
				'BALA_AMOUNT':'50',
				'TRADE_ITEM_COMMENTS':'点击消耗',
				'ACCOUNT_NO':'10000M00001',
				'ACCOUNT_ITEM_NO':'Item031',
				'ANOTHER_ENTITY':'StraightOrderItem',
				'ANOTHER_ITEM_NO':'P4P'}
				]】
			</method>
		</scenario>
		<scenario name="[Case02-成功]中文站会员P4P红包账户项余额100元，进行日结P4P红包消耗100元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item032',
				'ITEM_TYPE':'REDPACKET',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="init db for redpacket">
				向naq_integral_charge插入红包实体记录，金额与红包账户项余额一致，都为100
				【红包充值记录=[{'ID':'1',
				'INTEGRAL_NO':'JF201203020001',
				'VACCOUNT_ID':'10000',
				'ACCOUNT_NO':'10000M00001',
				'INTEGRAL_APPLY_ID':'9990',
				'TOTAL_TALLY':'100.00',
				'BALA_TALLY':'100.00'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为红包扣款，扣款金额为100元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":0,
				"execTally":100,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的账户余额
				【账户项=[{'ITEM_TYPE':'REDPACKET','ITEM_BALA':'0'}]】
			</method>
			<method type="then" name="check trade result">
				检查交易表的交易类型，审核状态，执行状态
				【账户交易=[{'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'EXEC_STATUS':'success'}
				]】

				检查交易项表的交易类型，交易金额，交易状态（AR/O交易）
				【账户交易项=[{'TRADE_STYLE':'self',
				'TRADE_TYPE':'AR/O',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'100',
				'FROM_ENTITY':'IntegralAccount',
				'FROM_NO':'10000M00001',
				'FROM_NO_DETAIL':'Item032',
				'TO_ENTITY':'StraightOrderItem',
				'TO_NO_DETAIL':'P4P',
				'EXEC_STATUS':'success',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TYPE_CODE':'ARXOXXXX'}
				]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'ALL_INCOMING',
				'EXEC_AMOUNT':'0',
				'RECEIPT_AMOUNT':'0',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'100',
				'RECEIPT_TALLY':'100',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check integral record">
				检查虚拟币交易表的交易记录
				【虚拟币交易记录=[{'INTEGRAL_NO':'JF201203020001',
				'ACCOUNT_NO':'10000M00001',
				'AMOUNT':'-100',
				'CURRENCY_TYPE':'CNY',
				'TRADE_TYPE':'AR/O',
				'PRODUCT_ID':'P4P',
				'PRODUCT_NAME':'网销宝',
				'COMMENTS':'点击消耗'}
				]】

				【虚拟币实体记录=[{'USED_TALLY':'100',
				'BALA_TALLY':'0'}
				]】
			</method>
		</scenario>
		<scenario
			name="[Case03-成功]中文站会员P4P现金账户项余额200元，红包账户项100元，进行日结现金消耗11.11元、红包消耗22.22元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入P4P现金和红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item031',
				'ITEM_TYPE':'P4P',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'200'},
				{'ID':'2',
				'ITEM_NO':'Item032',
				'ITEM_TYPE':'REDPACKET',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="init db for redpacket">
				向naq_integral_charge插入红包实体记录，金额与红包账户项余额一致，都为100
				【红包充值记录=[{'ID':'1',
				'INTEGRAL_NO':'JF201203020001',
				'VACCOUNT_ID':'10000',
				'ACCOUNT_NO':'10000M00001',
				'INTEGRAL_APPLY_ID':'9990',
				'TOTAL_TALLY':'100.00',
				'BALA_TALLY':'100.00'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，现金扣款11.11元，红包扣款22.22元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":11.11,
				"execTally":22.22,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的P4P红包和现金账户余额
				【账户项=[{'ITEM_TYPE':'P4P',
				'ITEM_BALA':'188.89'},
				{'ITEM_TYPE':'REDPACKET',
				'ITEM_BALA':'77.78'}
				]】
			</method>
			<method type="then" name="check trade result">
				检查交易表的交易类型，审核状态，执行状态
				【账户交易=[{'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'EXEC_STATUS':'success'}
				]】

				检查交易项表的交易类型，交易金额，交易状态（AP/O和AR/O交易）
				【账户交易项=[{'TRADE_STYLE':'self',
				'TRADE_TYPE':'AR/O',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'22.22',
				'FROM_ENTITY':'IntegralAccount',
				'FROM_NO':'10000M00001',
				'FROM_NO_DETAIL':'Item032',
				'TO_ENTITY':'StraightOrderItem',
				'TO_NO_DETAIL':'P4P',
				'EXEC_STATUS':'success',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TYPE_CODE':'ARXOXXXX'},
				{'TRADE_STYLE':'self',
				'TRADE_TYPE':'AP/O',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'11.11',
				'FROM_ENTITY':'P4pAccount',
				'FROM_NO':'10000M00001',
				'FROM_NO_DETAIL':'Item031',
				'TO_ENTITY':'StraightOrderItem',
				'TO_NO_DETAIL':'P4P',
				'EXEC_STATUS':'success',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TYPE_CODE':'APXOXXXX'}
				]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'ALL_INCOMING',
				'EXEC_AMOUNT':'11.11',
				'RECEIPT_AMOUNT':'11.11',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'22.22',
				'RECEIPT_TALLY':'22.22',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check account record">
				检查账户变更记录表的交易记录
				【现金交易记录=[{'VACCOUNT_ID':'10000',
				'CUSTOMER_NAME':'罗锐集成测试公司',
				'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'TRADE_COMMENTS':'即时付费订单自动扣款',
				'TRADE_ITEM_TYPE':'AP/O',
				'EXEC_STATUS':'success',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'-11.11',
				'BALA_AMOUNT':'188.89',
				'TRADE_ITEM_COMMENTS':'点击消耗',
				'ACCOUNT_NO':'10000M00001',
				'ACCOUNT_ITEM_NO':'Item031',
				'ANOTHER_ENTITY':'StraightOrderItem',
				'ANOTHER_ITEM_NO':'P4P'}
				]】
			</method>
			<method type="then" name="check integral record">
				检查虚拟币交易表的交易记录
				【虚拟币交易记录=[{'INTEGRAL_NO':'JF201203020001',
				'ACCOUNT_NO':'10000M00001',
				'AMOUNT':'-22.22',
				'CURRENCY_TYPE':'CNY',
				'TRADE_TYPE':'AR/O',
				'PRODUCT_ID':'P4P',
				'PRODUCT_NAME':'网销宝',
				'COMMENTS':'点击消耗'}
				]】

				【虚拟币实体记录=[{'USED_TALLY':'22.22',
				'BALA_TALLY':'77.78'}
				]】
			</method>
		</scenario>
		<scenario
			name="[Case04-成功]中文站会员P4P现金账户项余额100元，进行日结P4P现金消耗150元，扣款100成功，欠款50元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item031',
				'ITEM_TYPE':'P4P',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为现金扣款，扣款金额为150元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":150,
				"execTally":0,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'
				】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的账户余额，由于欠款统计是异步事件，无法同步更新，因此欠款仍然为0（原本应该为欠款50元）
				【账户项=[{'ITEM_TYPE':'P4P',
				'ITEM_BALA':'0',
				'DEBT_BALA':'0'}]】
			</method>
			<method type="then" name="check trade result">
				检查交易表的交易类型，审核状态，执行状态
				【账户交易=[{'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'EXEC_STATUS':'success'}
				]】
				检查交易项表的交易类型，交易金额，交易状态（AP/O交易）
				【账户交易项=[{'TRADE_STYLE':'self',
				'TRADE_TYPE':'AP/O',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'100',
				'FROM_ENTITY':'P4pAccount',
				'FROM_NO':'10000M00001',
				'FROM_NO_DETAIL':'Item031',
				'TO_ENTITY':'StraightOrderItem',
				'TO_NO_DETAIL':'P4P',
				'EXEC_STATUS':'success',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TYPE_CODE':'APXOXXXX'}
				]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'PART_INCOMING',
				'EXEC_AMOUNT':'150',
				'RECEIPT_AMOUNT':'100',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'0',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check account record">
				检查账户变更记录表的交易记录
				【现金交易记录=[{'VACCOUNT_ID':'10000',
				'CUSTOMER_NAME':'罗锐集成测试公司',
				'TRADE_SOURCE':'P4P',
				'TRADE_SOURCE_DETAIL':'Ricky_Test',
				'TRADE_TYPE':'NoAudit',
				'AUDIT_STATUS':'checked',
				'TRADE_COMMENTS':'即时付费订单自动扣款',
				'TRADE_ITEM_TYPE':'AP/O',
				'EXEC_STATUS':'success',
				'CURRENCY_TYPE':'CNY',
				'AMOUNT':'-100',
				'BALA_AMOUNT':'0',
				'TRADE_ITEM_COMMENTS':'点击消耗',
				'ACCOUNT_NO':'10000M00001',
				'ACCOUNT_ITEM_NO':'Item031',
				'ANOTHER_ENTITY':'StraightOrderItem',
				'ANOTHER_ITEM_NO':'P4P'}
				]】
			</method>
		</scenario>
		<scenario name="[Case05-失败]中文站会员P4P红包账户项余额100元，进行日结P4P红包消耗200元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item032',
				'ITEM_TYPE':'REDPACKET',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="init db for redpacket">
				向naq_integral_charge插入红包实体记录，金额与红包账户项余额一致，都为100
				【红包充值记录=[{'ID':'1',
				'INTEGRAL_NO':'JF201203020001',
				'VACCOUNT_ID':'10000',
				'ACCOUNT_NO':'10000M00001',
				'INTEGRAL_APPLY_ID':'9990',
				'TOTAL_TALLY':'100.00',
				'BALA_TALLY':'100.00'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为红包扣款，扣款金额为200元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":0,
				"execTally":200,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的账户余额
				【账户项=[{'ITEM_TYPE':'REDPACKET','ITEM_BALA':'100'}]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'ALL_INCOMING',
				'EXEC_AMOUNT':'0',
				'RECEIPT_AMOUNT':'0',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'200',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'WAIT_INCOMING'}
				]】
			</method>
		</scenario>
		<scenario
			name="[Case06-失败]中文站会员P4P现金账户项余额200元，红包账户项100元，进行日结现金消耗100元、红包消耗150元">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户、账户项信息（只填写关注的核心数据，非核心数据由代码生成）
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入P4P现金和红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item031',
				'ITEM_TYPE':'P4P',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'200'},
				{'ID':'2',
				'ITEM_NO':'Item032',
				'ITEM_TYPE':'REDPACKET',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="given" name="init db for redpacket">
				向naq_integral_charge插入红包实体记录，金额与红包账户项余额一致，都为100
				【红包充值记录=[{'ID':'1',
				'INTEGRAL_NO':'JF201203020001',
				'VACCOUNT_ID':'10000',
				'ACCOUNT_NO':'10000M00001',
				'INTEGRAL_APPLY_ID':'9990',
				'TOTAL_TALLY':'100.00',
				'BALA_TALLY':'100.00'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，现金扣款11.11元，红包扣款22.22元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":100,
				"execTally":150,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check account bala">
				检查账户项表的P4P红包和现金账户余额
				【账户项=[{'ITEM_TYPE':'P4P',
				'ITEM_BALA':'200'},
				{'ITEM_TYPE':'REDPACKET',
				'ITEM_BALA':'100'}
				]】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'WAIT_INCOMING',
				'EXEC_AMOUNT':'100',
				'RECEIPT_AMOUNT':'0',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'150',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'WAIT_INCOMING'}
				]】
			</method>
		</scenario>
		<scenario name="[Case07-失败]中文站会员无账户，创建即时付费订单成功，但进行日结P4P现金消耗50元的交易创建失败">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为现金扣款，扣款金额为50元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":50,
				"execTally":0,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】

				Then check straight order
				检查创建出来的即时付费订单（这里存在疑问，为什么要创建出这个扣款请求？连账户都没有）
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'WAIT_INCOMING',
				'EXEC_AMOUNT':'50',
				'RECEIPT_AMOUNT':'0',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'0',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check error result">
				由于不能捕获各种异常，因此只能通过数据库的记录条数来判断是否执行成功
			</method>
		</scenario>
		<scenario name="[Case08-失败]中文站会员无P4P现金账户项，进行日结P4P现金消耗50元失败">
			<method type="given" name="clean db">
				清空所有涉及的数据库表信息
				【清空表=[naq_customer,
				naq_account,
				naq_account_item,
				naq_account_record,
				naq_integral_charge,
				naq_integral_record,
				naq_trade,
				naq_trade_item,
				naq_straight_order
				]】
			</method>
			<method type="given" name="init db">
				初始化中文站会员在账户系统的客户、账户信息
				向naq_customer插入中文站客户信息
				【客户=[{'ID':'1',
				'GLOBAL_ID':'1',
				'VACCOUNT_ID':'10000',
				'SITE_ID':'CN'}
				]】
				向naq_account插入默认账户信息，关联到中文站客户
				【账户=[{'ID':'1',
				'CUSTOMER_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'VACCOUNT_ID':'10000'}
				]】
				向naq_account_item插入红包账户项信息，并关联到默认账户
				【账户项=[{'ID':'1',
				'ITEM_NO':'Item032',
				'ITEM_TYPE':'REDPACKET',
				'ACCOUNT_ID':'1',
				'ACCOUNT_NO':'10000M00001',
				'ITEM_BALA':'0'}
				]】
			</method>
			<method type="given" name="mock event publisher">
				[Mock]模拟交易完成后向EVENT队列发送消息
			</method>
			<method type="when" name="consumption trade">
				模拟发送P4P日结消耗消息，消息体中的产品为P4P，交易类型为现金扣款，扣款金额为50元
				【消耗信息='{"charsetFrom":"",
				"charsetTo":"",
				"currencyType":"CNY",
				"customerName":"",
				"domainFrom":"P4P",
				"domainTo":"",
				"encryptMap":{"vaccountId":"10000",
				"signTime":"null",
				"orderSourceDetail":"Ricky_Test",
				"domainFrom":"P4P"},
				"execAmount":50,
				"execTally":0,
				"operator":"",
				"orderComments":"点击消耗",
				"orderNo":"RickyTest_Order_0001",
				"orderSourceDetail":"Ricky_Test",
				"productId":"P4P",
				"signString":"",
				"signTime":null,
				"vaccountId":"10000"}'】
			</method>
			<method type="then" name="check straight order">
				检查创建出来的即时付费订单（这里存在疑问，为什么要创建出这个扣款请求？连账户都没有）
				【即时付费订单=[{'ORDER_NO':'RickyTest_Order_0001',
				'PRODUCT_ID':'P4P',
				'STATUS':'WAIT_INCOMING',
				'EXEC_AMOUNT':'50',
				'RECEIPT_AMOUNT':'0',
				'ORDER_SOURCE':'P4P',
				'ORDER_SOURCE_DETAIL':'Ricky_Test',
				'VACCOUNT_ID':'10000',
				'EXEC_TALLY':'0',
				'RECEIPT_TALLY':'0',
				'TALLY_STATUS':'ALL_INCOMING'}
				]】
			</method>
			<method type="then" name="check error result">
				由于不能捕获各种异常，因此只能通过数据库的记录条数来判断是否执行成功
			</method>
		</scenario>
	</scenarios>
</story>